pipeline {
    agent any
    
    environment {
        GIT_REPO_URL = 'git_url'
        SSH_CRED_ID  = 'ccb-deploy-ssh'     // Jenkins SSH key ID

        REMOTE_HOST  = ''
        BASE_DIR = ''
    }
    
    stages {

        stage('Onay 1') {
            steps {
                input message: "JSP/XJS ve benzeri dosya adreslere MANUEL yÃ¼klendi."
            }
        }
        
        stage('Structers temizleme ve InitialSetup ') {
            steps {
                script {
                    echo "ðŸ”§ initialSetup Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor..."

                    withCredentials([sshUserPrivateKey(
                        credentialsId: SSH_CRED_ID,
                        keyFileVariable: 'SSH_KEY',
                        usernameVariable: 'SSH_USER'
                    )]) {

                        sh """
                            ssh -i "\$SSH_KEY" -o StrictHostKeyChecking=no \$SSH_USER@${REMOTE_HOST} "
                                        sh /appdata/scripts/splenv.sh << EOF
                                        rm -rf /appdata/ouaf/CCBMIG/structures/*.processed
                                        sh /appdata/ouaf/CCBMIG/bin/initialSetup.sh << EOF
                                    "
                        """
                    }
                }
            }
        }
        stage('Restart Onay') {
                    steps {
                        input message: " InitialSetup tamamlandÄ±. Restart etmek iÃ§in Proceed' bas."
                    }
            }
        stage('Weblogic Restart') {
                        steps {
                            script {
                                echo "ðŸ”„ Weblogic restart baÅŸlatÄ±lÄ±yor..."
                    
                                withCredentials([sshUserPrivateKey(credentialsId: SSH_CRED_ID, 
                                                                   keyFileVariable: 'SSH_KEY', 
                                                                   usernameVariable: 'SSH_USER')]) {
                    
                                    sh """
                                        ssh -i \$SSH_KEY -o StrictHostKeyChecking=no \$SSH_USER@${REMOTE_HOST} "
                                            cd /appdata/restartconfig
                                            pwd
                                            sh starter.sh
                                        "
                                    """
                                }
                            }
                        }
                    }
    }
}
